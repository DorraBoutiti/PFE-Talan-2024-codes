<ng-container *ngIf="currentUser">
  <h2 class="title">Liste des demandes d'accès</h2>
  <div class="request-access-list">
    <ng-container *ngIf="usersWithoutPassword && usersWithoutPassword.length >= 0">
      <mat-form-field>
        <mat-label>Filtrer des résultats</mat-label>
        <input matInput placeholder="Filtrez par mot clé" #input (keyup)="applyFilter($event)">
      </mat-form-field>

      <div class="table-paginator">
        <table mat-table [dataSource]="dataSource" matSort (matSortChange)="sortData($event)">

          <ng-container matColumnDef="registrationNumber">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Matricule </th>
            <td mat-cell *matCellDef="let element"> {{element.registrationNumber}} </td>
          </ng-container>

          <ng-container matColumnDef="lastName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Nom </th>
            <td mat-cell *matCellDef="let element"> {{element.lastName}} </td>
          </ng-container>

          <ng-container matColumnDef="firstName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Prénom </th>
            <td mat-cell *matCellDef="let element"> {{element.firstName}} </td>
          </ng-container>

          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> E-mail </th>
            <td mat-cell *matCellDef="let element"> {{element.email}} </td>
          </ng-container>

          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Rôle </th>
            <td mat-cell *matCellDef="let element"> {{element.role == 'MANAGER' ? 'Manager' : 'Expert RH'}} </td>
          </ng-container>

          <ng-container matColumnDef="businessUnit">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Unité Organisationnelle </th>
            <td mat-cell *matCellDef="let element"> {{element.businessUnit == null ? '-' : element.businessUnit}} </td>
          </ng-container>

          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Description </th>
            <td mat-cell *matCellDef="let element"> {{ element.description || '-' }} </td>
          </ng-container>

          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef> Action </th>
            <td mat-cell *matCellDef="let element">
              <button mat-flat-button (click)="openProvideAccessDialog(element.email, '0ms', '0ms')"
                style="background-color: #457b9d; color: #fff; margin-right: 15px;">
                <span style="display: flex; align-items: center;">
                  <span *ngIf="loadingEmail !== element.email && action === '' || loadingEmail !== element.email && action === 'accept' || action === 'reject'" style="margin-right: 10px;">
                    Activer le compte</span>
                  <span *ngIf="loadingEmail === element.email && action === 'accept'"
                    style="margin-right: 10px;">Activation en cours</span>
                  <mat-spinner *ngIf="loadingEmail === element.email && action === 'accept'" diameter="20"
                    style="margin-right: 5px;"></mat-spinner>
                </span>
              </button>

              <button mat-flat-button (click)="openRejectRequestDialog(element.email, '0ms', '0ms')" style="background-color: #e63946; color: #fff; margin-right: 15px;">
                <span style="display: flex; align-items: center;">
                  <span *ngIf="loadingEmail !== element.email && action === '' || action === 'accept' || loadingEmail !== element.email && action === 'reject'"
                    style="margin-right: 10px;">Refuser la demande</span>
                  <span *ngIf="loadingEmail === element.email && action === 'reject'"
                   style="margin-right: 10px;">Refus en cours</span>
                  <mat-spinner color="#1d3557" *ngIf="loadingEmail === element.email && action === 'reject'" diameter="20"
                    style="margin-right: 5px;"></mat-spinner>
                </span>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="8">Aucune donnée correspondant au filtre "{{input.value}}"</td>
          </tr>
        </table>

        <mat-paginator [pageSizeOptions]="[10, 20, 30, 50]" (page)="onPaginateChange($event)" aria-label="Select page of users" [pageIndex]="pgIndex">
        </mat-paginator>
      </div>
    </ng-container>
  </div>
</ng-container>
